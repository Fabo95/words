generator client {
  provider = "prisma-client"
  output   = "../src/generated/user-db"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model users {
  id                Int                 @id @default(autoincrement())
  email             String              @db.VarChar
  password          String              @db.VarChar
  name              String?             @db.VarChar
  password_salt     String              @db.VarChar
  token_salt        String              @db.VarChar
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  updated_at        DateTime            @default(now()) @db.Timestamptz(6)
  collections       collections[]
  daily_statistics  daily_statistics[]
  learning_progress learning_progress[]
  translations      translations[]
  user_daily_goals  user_daily_goals?
}

model collections {
  id           Int            @id @default(autoincrement())
  name         String         @db.VarChar
  user_id      Int
  created_at   DateTime       @default(now()) @db.Timestamptz(6)
  updated_at   DateTime       @default(now()) @db.Timestamptz(6)
  users        users          @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "FK_one_user_has_many_collections")
  translations translations[]
}

model example_sentences {
  id             Int          @id @default(autoincrement())
  translation_id Int
  sentence       String       @db.VarChar
  language       String       @db.VarChar
  translations   translations @relation(fields: [translation_id], references: [id], onDelete: Cascade, map: "FK_one_translation_has_many_examples")
}

model seaql_migrations {
  version    String @id @db.VarChar
  applied_at BigInt
}

model translations {
  id                              Int                               @id @default(autoincrement())
  source_language                 String                            @db.VarChar
  source_text                     String                            @db.VarChar
  target_language                 String                            @db.VarChar
  target_text                     String                            @db.VarChar
  user_id                         Int
  created_at                      DateTime                          @default(now()) @db.Timestamptz(6)
  updated_at                      DateTime                          @default(now()) @db.Timestamptz(6)
  collection_id                   Int?
  cefr_level_id                   Int?
  example_sentences               example_sentences[]
  learning_progress               learning_progress[]
  collections                     collections?                      @relation(fields: [collection_id], references: [id], map: "FK_one_collection_has_many_translations")
  users                           users                             @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "FK_one_user_has_many_translations")
  cefr_levels                     cefr_levels?                      @relation(fields: [cefr_level_id], references: [id], map: "FK_translation_cefr_level")
  translations_universal_pos_tags translations_universal_pos_tags[]
}

model cefr_levels {
  id           Int            @id @default(autoincrement())
  code         String         @unique @db.VarChar
  name         String         @db.VarChar
  description  String?        @db.VarChar
  translations translations[]
}

model universal_pos_tags {
  id                              Int                               @id @default(autoincrement())
  code                            String                            @unique @db.VarChar
  name                            String                            @db.VarChar
  description                     String?                           @db.VarChar
  translations_universal_pos_tags translations_universal_pos_tags[]
}

model translations_universal_pos_tags {
  translation_id       Int
  universal_pos_tag_id Int
  translations         translations       @relation(fields: [translation_id], references: [id], onDelete: Cascade, map: "FK_tupt_translation")
  universal_pos_tags   universal_pos_tags @relation(fields: [universal_pos_tag_id], references: [id], onDelete: Cascade, map: "FK_tupt_universal_pos_tag")

  @@id([translation_id, universal_pos_tag_id])
  @@index([translation_id], map: "idx_tupt_translation_id")
  @@index([universal_pos_tag_id], map: "idx_tupt_universal_pos_tag_id")
}

model learning_progress {
  id               Int          @id @default(autoincrement())
  user_id          Int
  translation_id   Int
  ease_factor      Float        @default(2.5) @db.Real
  interval         Int          @default(0)
  repetition_count Int          @default(0)
  next_review_at   DateTime?    @db.Timestamptz(6)
  last_reviewed_at DateTime?    @db.Timestamptz(6)
  created_at       DateTime     @default(now()) @db.Timestamptz(6)
  updated_at       DateTime     @default(now()) @db.Timestamptz(6)
  translations     translations @relation(fields: [translation_id], references: [id], onDelete: Cascade, map: "FK_learning_progress_translation")
  users            users        @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "FK_learning_progress_user")

  @@unique([user_id, translation_id], map: "idx_learning_progress_user_translation_unique")
  @@index([user_id, next_review_at], map: "idx_learning_progress_next_review")
}

model user_daily_goals {
  id                       Int       @id @default(autoincrement())
  user_id                  Int       @unique
  daily_add_words_goal     Int       @default(5)
  words_added_today        Int       @default(0)
  current_streak           Int       @default(0)
  longest_streak           Int       @default(0)
  last_goal_completed_date DateTime? @db.Timestamptz(6)
  last_reset_date          DateTime  @default(now()) @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @default(now()) @db.Timestamptz(6)
  users                    users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "FK_user_daily_goals_user")

  @@index([last_reset_date], map: "idx_user_daily_goals_last_reset_date")
}

model daily_statistics {
  id                   Int      @id @default(autoincrement())
  user_id              Int
  date                 DateTime @db.Date
  words_added          Int      @default(0)
  daily_goal           Int
  goal_completed       Boolean  @default(false)
  streak_at_end_of_day Int      @default(0)
  total_translations   Int      @default(0)
  learning_count       Int      @default(0)
  mature_count         Int      @default(0)
  created_at           DateTime @default(now()) @db.Timestamptz(6)
  users                users    @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "FK_daily_statistics_user")

  @@unique([user_id, date], map: "idx_daily_statistics_user_date_unique")
  @@index([user_id, date], map: "idx_daily_statistics_user_date")
}
